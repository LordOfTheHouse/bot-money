# Telegram Expense Bot (Java 17 + Spring Boot 3)

Групповой Telegram-бот для учёта трат по людям и автоматических ежедневных сводок **в заданный период**.

## Возможности
- Принимает строки вида `Имя +300`, `Имя -30`, `Петров +20` прямо в беседе — операции учитываются **без ответа в чат**.
- Хранит начальные суммы по людям (задаются один раз, можно менять).
- В конце дня публикует сводку по всем людям **с начальной суммой**, **только в пределах заданного периода**.
- Работает в группах/супергруппах, поддерживает несколько чатов одновременно.
- Настраиваемые часовой пояс и время рассылки.

## Команды
```
/period YYYY-MM-DD YYYY-MM-DD  — задать период ежедневных сводок
/tz Area/City                  — установить часовой пояс (например, Europe/Moscow)
/time HH:mm                    — время ежедневной сводки
/setinitial <Имя> <Сумма>     — установить/изменить начальную сумму явно
/summary                       — показать сводку сейчас
/help                          — показать справку
```
**Обычные строки** формата `Имя +/-Сумма` обрабатываются молча.

## Сборка и запуск
1. Создайте бота у @BotFather и получите токен.
2. Установите переменные окружения (или пропишите в `application.yml`):
   ```bash
   export BOT_USERNAME=your_bot_username
   export BOT_TOKEN=123456:ABC-DEF...
   ```
3. Соберите и запустите:
   ```bash
   ./mvnw -q -DskipTests package
   java -jar target/telegram-expense-bot-1.0.0.jar
   ```

База — H2 (файловая) в каталоге `./data/expensedb` рядом с приложением.

## Как это работает
- Первая запись `Имя +N` для неизвестного человека трактуется как **начальная сумма**.
- Любые последующие `Имя +/-X` — это операции (транзакции).
- Ежеминутный планировщик проверяет, пора ли отправить сводку для каждого чата,
  учитывая **период**, **часовой пояс** и **время**. За день только одна сводка.

## Примечания
- Бот игнорирует личные чаты: работает только в группах/супергруппах.
- Сводка включает только людей с заданной начальной суммой.
- Часовые пояса задаются в формате `Area/City` (см. IANA TZDB).

## Пример
```
/period 2025-10-01 2025-10-31
/tz Europe/Moscow
/time 23:30
Петров +300
Петров -30
Иванов +500
Иванов -120
/summary
```
Сводка отобразит текущие балансы по Петрову и Иванову.

---

Made with ❤️ by Универ Шмеля
